<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DISTRIBUCION I HOJA DE RUTA GRUPODN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
}

/* HEADER */
header {
  background: #f5b400;
  color: white;
  text-align: center;
  padding: 14px;
  font-size: 18px;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 1000;
}

/* CONTENEDOR */
.container {
  padding: 14px;
}

/* BUSCADOR */
.search-wrapper {
  position: relative;
  margin-bottom: 14px;
}

.search-wrapper input {
  width: 100%;
  padding: 14px 14px 14px 42px;
  font-size: 16px;
  border-radius: 30px;
  border: 1px solid #ddd;
  outline: none;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.search-icon {
  position: absolute;
  left: 14px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 16px;
  color: #888;
}

/* TARJETA CLIENTE */
.cliente {
  background: white;
  border-radius: 8px;
  padding: 12px;
  margin-bottom: 14px;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}

.total {
  margin-top: 6px;
  font-weight: bold;
  font-size: 18px;
  color: #c0392b;
}

.btn {
  margin-top: 8px;
  padding: 8px 12px;
  border: none;
  background: #2980b9;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}

/* DETALLE */
.detalle {
  display: none;
  margin-top: 8px;
  border-top: 1px solid #ddd;
  padding-top: 8px;
}

.producto {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  padding: 6px 0;
  border-bottom: 1px solid #eee;
}

.producto .desc {
  flex: 2;
}

.producto .cant {
  flex: 1;
  text-align: center;
}

.producto .monto {
  flex: 1;
  text-align: right;
  font-weight: bold;
}

/* CONTADOR */
#contador {
  margin-bottom: 10px;
  font-weight: bold;
  color: #555;
}

/* FOOTER */
footer {
  text-align: center;
  padding: 10px;
  font-size: 12px;
  background: #222;
  color: white;
  margin-top: 20px;
}
</style>
</head>

<body>

<header>
DISTRIBUCION I HOJA DE RUTA GRUPODN
</header>

<div class="container">

<div class="search-wrapper">
  <span class="search-icon">üîç</span>
  <input
    type="text"
    id="buscador"
    placeholder="Buscar por c√≥digo o nombre del cliente"
  >
</div>

<div id="contador"></div>
<div id="resultados"></div>

</div>

<footer>
Sistema Hoja de Ruta ¬© 2026 - GrupoDN
</footer>

<script>
let pedidos = [];
let debounceTimer = null;

fetch('pedidos.json')
  .then(r => r.json())
  .then(data => pedidos = data);

document.getElementById('buscador').addEventListener('input', () => {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(buscar, 300);
});

function buscar() {
  const q = buscador.value.toLowerCase();
  resultados.innerHTML = '';
  contador.innerHTML = '';

  if (q.length < 1) return;

  const filtrados = pedidos.filter(p =>
    p["CODIGO.CLIENTE"].toString().includes(q) ||
    p["NOMBRE.CLIENTE"].toLowerCase().includes(q)
  );

  const agrupados = {};
  filtrados.forEach(p => {
    if (!agrupados[p["CODIGO.CLIENTE"]]) {
      agrupados[p["CODIGO.CLIENTE"]] = [];
    }
    agrupados[p["CODIGO.CLIENTE"]].push(p);
  });

  contador.innerHTML = `Clientes encontrados: ${Object.keys(agrupados).length}`;

  Object.values(agrupados).forEach(lista => renderCliente(lista));
}

function renderCliente(lista) {
  const p = lista[0];
  const total = lista.reduce((s,x)=>s + x.Monto, 0).toFixed(2);

  const div = document.createElement('div');
  div.className = 'cliente';

  div.innerHTML = `
    <strong>${p["NOMBRE.CLIENTE"]}</strong><br>
    C√≥digo: ${p["CODIGO.CLIENTE"]}<br>
    üöö Conductor: ${p.CONDUCTOR}<br>
    üöõ Placa: ${p["VEHICULO"]}<br>
    üíº Liquidador: ${p.LIQUIDADOR}<br>
    üìû Contacto: ${p["NROS DE CONTACTO"]}

    <div class="total">TOTAL: S/ ${Number(total).toFixed(2)}</div>

    <button class="btn" onclick="
      const d=this.nextElementSibling;
      d.style.display=d.style.display==='block'?'none':'block';
    ">
      Ver detalle
    </button>

    <div class="detalle">
      ${lista.map(x => `
        <div class="producto">
          <div class="desc">${x.Descripcion}</div>
          <div class="cant">${x["Unidades Programadas"]} und</div>
          <div class="monto">S/ ${Number(x.Monto).toFixed(2)}</div>
        </div>
      `).join('')}
    </div>
  `;

  resultados.appendChild(div);
}
</script>

</body>
</html>
