<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DISTRIBUCION APP I hoja de ruta</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body { font-family: Arial; margin:0; background:#f4f4f4; }
header { background:#ffda40; color:#fff; padding:15px; text-align:center; font-weight:bold; }
.tabs { display:flex; background:#333; }
.tab { flex:1; padding:12px; color:#fff; text-align:center; cursor:pointer; }
.tab.active { background:#555; }
.content { display:none; padding:15px; }
.content.active { display:block; }
input, select { width:100%; padding:10px; margin-bottom:10px; }
.card { background:#fff; padding:12px; margin-bottom:10px; border-radius:6px; }
.total { font-size:18px; font-weight:bold; color:#d32f2f; margin-top:6px; }
.products { display:none; margin-top:6px; padding-left:15px; }
.btn { padding:6px 10px; border:none; border-radius:4px; cursor:pointer; margin-top:6px; }
.btn-wa { background:#25d366; color:#fff; }
.btn-toggle { background:#1976d2; color:#fff; }
</style>
</head>

<body>

<header>DISTRIBUCION APP I hoja de ruta</header>

<div class="tabs">
  <div class="tab active" onclick="openTab(0)">üîç Buscador</div>
  <div class="tab" onclick="openTab(1)">üìã Clientes por vendedor</div>
</div>

<div class="content active">
  <input id="searchInput" placeholder="Buscar por c√≥digo o nombre de cliente">
  <div id="searchResults"></div>
</div>

<div class="content">
  <select id="sellerFilter" onchange="filterSeller()">
    <option value="">Seleccione vendedor</option>
  </select>
  <div id="sellerResults"></div>
</div>

<script>
let pedidos = [];
let clientes = [];

fetch("pedidos.json")
  .then(r => r.json())
  .then(data => {
    pedidos = data;
    agruparClientes();
    cargarVendedores();
  });

function agruparClientes() {
  const map = {};

  pedidos.forEach(p => {
    const key = p.codigo;
    if (!map[key]) {
      map[key] = {
        ...p,
        productos: [],
        total: 0
      };
    }
    map[key].productos.push({
      nombre: p.producto,
      cantidad: p.cantidad
    });
    map[key].total += Number(p.total);
  });

  clientes = Object.values(map);
}

function openTab(i) {
  document.querySelectorAll('.tab').forEach((t,idx)=>t.classList.toggle('active',idx===i));
  document.querySelectorAll('.content').forEach((c,idx)=>c.classList.toggle('active',idx===i));
}

let debounce;
searchInput.oninput = e => {
  clearTimeout(debounce);
  debounce = setTimeout(() => buscar(e.target.value.toLowerCase()), 300);
};

function buscar(txt) {
  const res = clientes.filter(c =>
    c.codigo.toLowerCase().includes(txt) ||
    c.cliente.toLowerCase().includes(txt)
  );
  render(res, "searchResults");
}

function cargarVendedores() {
  const vendedores = [...new Set(clientes.map(c => c.vendedor))];
  const sel = sellerFilter;
  vendedores.forEach(v => {
    const o = document.createElement("option");
    o.value = v;
    o.textContent = v;
    sel.appendChild(o);
  });
}

function filterSeller() {
  const v = sellerFilter.value;
  const res = clientes.filter(c => c.vendedor === v);
  render(res, "sellerResults");
}

function render(list, id) {
  const cont = document.getElementById(id);
  cont.innerHTML = "";

  list.forEach(c => {
    const prodHtml = c.productos.map(p => `‚Ä¢ ${p.nombre} (${p.cantidad})`).join("<br>");

    const msg = `Cliente: ${c.cliente}
Conductor: ${c.conductor}
Liquidador: ${c.liquidador}
Placa: ${c.placa}
Tel√©fono: ${c.telefono}

Productos:
${c.productos.map(p=>`- ${p.nombre} (${p.cantidad})`).join("\n")}

TOTAL: S/ ${c.total}`;

    cont.innerHTML += `
      <div class="card">
        <strong>${c.codigo} - ${c.cliente}</strong><br>
        Conductor: ${c.conductor}<br>
        Liquidador: ${c.liquidador}<br>
        Placa: ${c.placa}<br>
        Tel√©fono: ${c.telefono}<br>

        <button class="btn btn-toggle" onclick="this.nextElementSibling.style.display =
          this.nextElementSibling.style.display==='block'?'none':'block'">
          Ver productos
        </button>

        <div class="products">${prodHtml}</div>

        <div class="total">TOTAL: S/ ${c.total}</div>

        <a class="btn btn-wa" target="_blank"
           href="https://wa.me/?text=${encodeURIComponent(msg)}">
           Compartir por WhatsApp
        </a>
      </div>
    `;
  });
}
</script>

</body>
</html>

