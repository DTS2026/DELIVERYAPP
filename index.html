<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>DISTRIBUCION I HOJA DE RUTA GRUPODN</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
}

header {
  background: #f5b400;
  color: white;
  text-align: center;
  padding: 14px;
  font-size: 20px;
  font-weight: bold;
}

.container {
  padding: 12px;
}

input {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  margin-bottom: 12px;
}

.cliente {
  background: white;
  border-radius: 6px;
  padding: 10px;
  margin-bottom: 12px;
}

.total {
  margin-top: 6px;
  font-weight: bold;
  font-size: 18px;
  color: #c0392b;
}

.btn {
  margin-top: 8px;
  padding: 8px 12px;
  border: none;
  background: #2980b9;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}

.detalle {
  display: none;
  margin-top: 8px;
  border-top: 1px solid #ddd;
  padding-top: 8px;
}

.producto {
  font-size: 14px;
  margin-bottom: 4px;
}
</style>
</head>

<body>

<header>
DISTRIBUCION I HOJA DE RUTA GRUPODN
</header>

<div class="container">

<input
  type="text"
  id="buscador"
  placeholder="ðŸ” Buscar por cÃ³digo o nombre del cliente"
>

<div id="resultados"></div>

</div>

<script>
let pedidos = [];
let debounceTimer = null;

fetch('pedidos.json')
  .then(r => r.json())
  .then(data => pedidos = data);

document.getElementById('buscador').addEventListener('input', () => {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(buscar, 300);
});

function buscar() {
  const q = buscador.value.toLowerCase();
  resultados.innerHTML = '';

  if (q.length < 1) return;

  const filtrados = pedidos.filter(p =>
    p["CODIGO.CLIENTE"].toString().includes(q) ||
    p["NOMBRE.CLIENTE"].toLowerCase().includes(q)
  );

  const agrupados = {};
  filtrados.forEach(p => {
    if (!agrupados[p["CODIGO.CLIENTE"]]) {
      agrupados[p["CODIGO.CLIENTE"]] = [];
    }
    agrupados[p["CODIGO.CLIENTE"]].push(p);
  });

  Object.values(agrupados).forEach(lista => renderCliente(lista));
}

function renderCliente(lista) {
  const p = lista[0];
  const total = lista.reduce((s,x)=>s + x.Monto, 0).toFixed(2);

  const div = document.createElement('div');
  div.className = 'cliente';

  div.innerHTML = `
    <strong>${p["NOMBRE.CLIENTE"]}</strong><br>
    CÃ³digo: ${p["CODIGO.CLIENTE"]}<br>
    ðŸšš Conductor: ${p.CONDUCTOR}<br>
    ðŸš› Placa: ${p["PLACA.ASIGNADA"]}<br>
    ðŸ’¼ Liquidador: ${p.LIQUIDADOR}<br>
    ðŸ“ž Contacto: ${p["NROS DE CONTACTO"]}

    <div class="total">TOTAL: S/ ${total}</div>

    <button class="btn" onclick="
      const d=this.nextElementSibling;
      d.style.display=d.style.display==='block'?'none':'block';
    ">
      Ver detalle
    </button>

    <div class="detalle">
      ${lista.map(x => `
        <div class="producto">
          ${x.Descripcion} â€” ${x["Unidades Programadas"]} und â€” S/ ${x.Monto}
        </div>
      `).join('')}
    </div>
  `;

  resultados.appendChild(div);
}
</script>

</body>
</html>
