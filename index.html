<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>DISTRIBUCION I HOJA DE RUTA GRUPODN</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f4f4f4;
  font-size: 16px;
}

header {
  background: #f2b705;
  color: #fff;
  text-align: center;
  padding: 16px 10px;
  font-weight: bold;
  position: sticky;
  top: 0;
  z-index: 1000;
}

header h1 {
  margin: 0;
  font-size: 18px;
}

input {
  width: 92%;
  margin: 12px auto;
  display: block;
  padding: 14px;
  font-size: 16px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

#resultados {
  padding: 10px;
}

.cliente {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}

.cliente h3 {
  margin: 0 0 6px 0;
}

.info {
  font-size: 14px;
  margin-bottom: 6px;
}

.total {
  font-size: 20px;
  font-weight: bold;
  color: #0a7a0a;
  margin: 8px 0;
}

.productos {
  display: none;
  margin-top: 8px;
  font-size: 14px;
}

.productos div {
  border-bottom: 1px dashed #ddd;
  padding: 4px 0;
}

button {
  border: none;
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 14px;
  cursor: pointer;
}

.btn-toggle {
  background: #ddd;
  margin-top: 6px;
}

.btn-wsp {
  background: #25D366;
  color: #fff;
  margin-top: 8px;
  width: 100%;
}
</style>
</head>

<body>

<header>
  <h1>DISTRIBUCION I HOJA DE RUTA GRUPODN</h1>
</header>

<input id="buscador" type="text" placeholder="Buscar por cÃ³digo o nombre del cliente">

<div id="resultados"></div>

<script>
let pedidos = [];
let timer = null;

fetch("pedidos.json")
  .then(res => res.json())
  .then(data => pedidos = data);

const buscador = document.getElementById("buscador");
const resultados = document.getElementById("resultados");

buscador.addEventListener("input", () => {
  clearTimeout(timer);
  timer = setTimeout(buscar, 300);
});

function buscar() {
  const texto = buscador.value.toLowerCase().trim();
  resultados.innerHTML = "";
  if (texto.length < 2) return;

  const filtrados = pedidos.filter(p =>
    String(p["CODIGO.CLIENTE"]).includes(texto) ||
    p["NOMBRE.CLIENTE"].toLowerCase().includes(texto)
  );

  const clientes = {};

  filtrados.forEach(p => {
    const key = p["CODIGO.CLIENTE"];
    if (!clientes[key]) {
      clientes[key] = {
        codigo: key,
        nombre: p["NOMBRE.CLIENTE"],
        distrito: p["distrito"],
        conductor: p["CONDUCTOR"],
        placa: p["VEHICULO"],
        liquidador: p["LIQUIDADOR"],
        contacto: p["NROS DE CONTACTO"],
        total: 0,
        productos: []
      };
    }

    clientes[key].productos.push(p);
    clientes[key].total += Number(p["Monto"] || 0);
  });

  Object.values(clientes).forEach(c => pintarCliente(c));
}

function pintarCliente(c) {
  const div = document.createElement("div");
  div.className = "cliente";

  const productosHTML = c.productos.map(p =>
    `<div>â€¢ ${p["Descripcion"]} â€” ${p["Unidades Programadas"]} ${p["unidad"]}</div>`
  ).join("");

  div.innerHTML = `
    <h3>${c.nombre}</h3>
    <div class="info">CÃ³digo: ${c.codigo}</div>
    <div class="info">Distrito: ${c.distrito}</div>
    <div class="info">ðŸšš ${c.conductor} | ðŸš› ${c.placa}</div>
    <div class="info">ðŸ‘· ${c.liquidador} | ðŸ“ž ${c.contacto}</div>

    <div class="total">TOTAL: S/ ${c.total.toFixed(2)}</div>

    <button class="btn-toggle" onclick="toggleProductos(this)">Ver productos</button>
    <div class="productos">${productosHTML}</div>

    <button class="btn-wsp" onclick='compartir(${JSON.stringify(c)})'>
      ðŸ“² Compartir por WhatsApp
    </button>
  `;

  resultados.appendChild(div);
}

function toggleProductos(btn) {
  const prod = btn.nextElementSibling;
  prod.style.display = prod.style.display === "none" ? "block" : "none";
  btn.textContent = prod.style.display === "none" ? "Ver productos" : "Ocultar productos";
}

function compartir(c) {
  const productos = c.productos
    .map(p => `â€¢ ${p["Descripcion"]} (${p["Unidades Programadas"]})`)
    .join("\n");

  const mensaje =
`HOJA DE RUTA â€“ GRUPODN
Cliente: ${c.nombre}

${productos}

TOTAL: S/ ${c.total.toFixed(2)}

Conductor: ${c.conductor}
Placa: ${c.placa}
Liquidador: ${c.liquidador}
Contacto: ${c.contacto}`;

  window.open("https://wa.me/?text=" + encodeURIComponent(mensaje));
}
</script>

</body>
</html>


