<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hoja de Ruta - Grupo DN</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:20px;
}

h1{
  text-align:center;
  color:#1e3a8a;
}

input{
  width:100%;
  padding:12px;
  margin:20px 0;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:16px;
}

.card{
  background:#fff;
  padding:18px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 4px 8px rgba(0,0,0,0.05);
}

.codigo{
  font-size:14px;
  color:#666;
  margin-bottom:10px;
}

.linea-horizontal{
  display:flex;
  justify-content:space-between;
  flex-wrap:wrap;
  margin-bottom:10px;
}

.info{
  margin-bottom:6px;
}

.botones{
  margin-top:12px;
}

.btn{
  padding:8px 12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  text-decoration:none;
  display:inline-block;
  margin-right:8px;
  font-size:14px;
}

.btn-detalle{
  background:#1e3a8a;
  color:white;
}

.btn-wsp{
  background:#16a34a;
  color:white;
}

.detalle{
  display:none;
  margin-top:15px;
  border-top:1px solid #ddd;
  padding-top:10px;
}

.producto{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
}

.desc{
  flex:2;
}

.cant{
  flex:1;
  text-align:center;
}

.monto{
  flex:1;
  text-align:right;
}

.totales{
  margin-top:10px;
  border-top:1px solid #ddd;
  padding-top:8px;
}

.subtotal{
  font-weight:bold;
}

.totalgeneral{
  font-weight:bold;
  color:#1e3a8a;
  font-size:16px;
}
</style>
</head>

<body>

<h1>ğŸšš HOJA DE RUTA - GRUPODN</h1>

<input type="text" id="buscador" placeholder="Buscar por cÃ³digo o nombre de cliente...">

<div id="resultados"></div>

<script>
let pedidos=[];
let debounceTimer=null;

fetch('pedidos.json')
.then(r=>r.json())
.then(data=>pedidos=data);

// ğŸ”¹ FunciÃ³n inteligente para detectar Monto con o sin espacios
function obtenerMonto(obj){
  const key = Object.keys(obj).find(k => k.trim() === "Monto");
  if(!key) return 0;
  const valor=parseFloat(obj[key]);
  return isNaN(valor)?0:valor;
}

document.getElementById('buscador').addEventListener('input',()=>{
  clearTimeout(debounceTimer);
  debounceTimer=setTimeout(buscar,300);
});

function buscar(){
  const q=buscador.value.toLowerCase();
  resultados.innerHTML='';
  if(q.length<1) return;

  const filtrados=pedidos.filter(p=>
    p["CODIGO.CLIENTE"]?.toString().includes(q) ||
    p["NOMBRE.CLIENTE"]?.toLowerCase().includes(q)
  );

  const agrupados={};
  filtrados.forEach(p=>{
    if(!agrupados[p["CODIGO.CLIENTE"]])
      agrupados[p["CODIGO.CLIENTE"]]=[];
    agrupados[p["CODIGO.CLIENTE"]].push(p);
  });

  Object.values(agrupados).forEach(lista=>renderCliente(lista));
}

function renderCliente(lista){

  const p=lista[0];

  const subtotal=lista.reduce((s,x)=> s + obtenerMonto(x),0);
  const igv=subtotal*0.18;
  const totalGeneral=subtotal+igv;

  const detalleTexto = lista.map(x=>{
    return `â€¢ ${x.Descripcion} - ${x["Unidades Programadas"]} und - S/ ${obtenerMonto(x).toFixed(2)}`;
  }).join('%0A');

  const mensaje =
`*ğŸšš HOJA DE RUTA - GRUPODN*%0A
ğŸ¢ Cliente: ${p["NOMBRE.CLIENTE"]}%0A
ğŸ†” CÃ³digo: ${p["CODIGO.CLIENTE"]}%0A
ğŸ“ TelÃ©fonos: ${p["NROS DE CONTACTO"]}%0A
ğŸš› Placa: ${p["VEHICULO"]}%0A
ğŸ‘¤ Conductor: ${p.CONDUCTOR}%0A
ğŸ“¦ Repartidor: ${p.LIQUIDADOR}%0A
%0A*ğŸ“‹ DETALLE DEL PEDIDO*%0A
${detalleTexto}%0A
%0AğŸ’° Subtotal: S/ ${subtotal.toFixed(2)}%0A
ğŸ§¾ IGV (18%): S/ ${igv.toFixed(2)}%0A
*TOTAL GENERAL: S/ ${totalGeneral.toFixed(2)}*`;

  const div=document.createElement('div');
  div.className='card';

  div.innerHTML=`
    <h3>ğŸ¢ ${p["NOMBRE.CLIENTE"]}</h3>
    <div class="codigo">ğŸ†” CÃ³digo Cliente: ${p["CODIGO.CLIENTE"]}</div>

    <div class="linea-horizontal">
      <div>ğŸš› <strong>Placa Programada:</strong> ${p["VEHICULO"]}</div>
      <div>ğŸ‘¤ <strong>Conductor:</strong> ${p.CONDUCTOR}</div>
    </div>

    <div class="info">ğŸ“¦ <strong>Repartidor:</strong> ${p.LIQUIDADOR}</div>
    <div class="info">ğŸ“ <strong>TelÃ©fonos TripulaciÃ³n:</strong> ${p["NROS DE CONTACTO"]}</div>

    <div class="botones">
      <button class="btn btn-detalle" onclick="
        const d=this.closest('.card').querySelector('.detalle');
        d.style.display=d.style.display==='block'?'none':'block';
      ">ğŸ“‹ Ver detalle</button>

      <a class="btn btn-wsp" target="_blank"
      href="https://wa.me/?text=${mensaje}">
      ğŸ“² Compartir WhatsApp</a>
    </div>

    <div class="detalle">
      ${lista.map(x=>`
        <div class="producto">
          <div class="desc">${x.Descripcion}</div>
          <div class="cant">${x["Unidades Programadas"]} und</div>
          <div class="monto">S/ ${obtenerMonto(x).toFixed(2)}</div>
        </div>
      `).join('')}

      <div class="totales">
        <div class="subtotal">Subtotal: S/ ${subtotal.toFixed(2)}</div>
        <div>IGV (18%): S/ ${igv.toFixed(2)}</div>
        <div class="totalgeneral">TOTAL GENERAL: S/ ${totalGeneral.toFixed(2)}</div>
      </div>
    </div>
  `;

  resultados.appendChild(div);
}
</script>

</body>
</html>




