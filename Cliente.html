<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta de Pedido - YUGO CORP</title>

<style>
body{
    margin:0;
    font-family: 'Segoe UI', sans-serif;
    background:#f4f6f9;
    display:flex;
    justify-content:center;
}

.app{
    width:100%;
    max-width:420px;
    background:white;
    min-height:100vh;
    box-shadow:0 0 25px rgba(0,0,0,0.1);
}

.header{
    background:linear-gradient(135deg,#0d6efd,#0a58ca);
    color:white;
    padding:25px 20px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
}

.container{
    padding:20px;
}

input{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid #ccc;
    margin-bottom:15px;
    font-size:15px;
}

button{
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    font-size:15px;
    cursor:pointer;
    margin-bottom:12px;
}

.btn-primary{
    background:#0d6efd;
    color:white;
}

.btn-primary:hover{
    background:#084298;
}

.btn-whatsapp{
    background:#25D366;
    color:white;
    font-weight:bold;
}

.btn-whatsapp:hover{
    background:#1ebe5d;
}

.card{
    background:#f8f9fa;
    padding:15px;
    border-radius:12px;
    margin-top:15px;
    font-size:14px;
}

.qr-section{
    text-align:center;
    margin-top:20px;
}

.qr-section img{
    width:180px;
    border-radius:12px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}
</style>

<script>
async function buscarPedido(){

    const codigoInput = document.getElementById("codigo");
    if(!codigoInput) return;

    const codigo = codigoInput.value.trim();
    if(!codigo){
        alert("Ingrese su código de pedido");
        return;
    }

    try{

        // ⚠️ MANTÉN AQUÍ TU URL ORIGINAL DEL JSON
        const response = await fetch("TU_URL_JSON_AQUI");
        const data = await response.json();

        // Comparación ignorando espacios y mayúsculas
        const pedido = data.find(item =>
            item.codigo &&
            item.codigo.toString().replace(/\s+/g,'').toLowerCase() ===
            codigo.replace(/\s+/g,'').toLowerCase()
        );

        if(!pedido){
            document.getElementById("resultado").innerHTML =
                "<div class='card'>No se encontró el pedido.</div>";
            return;
        }

        // Mostrar exactamente como estaba originalmente

        // Filtrar todos los registros del cliente
const pedidosCliente = data.filter(item =>
    item["CODIGO.CLIENTE"] &&
    item["CODIGO.CLIENTE"].toString().trim() === codigo
);

if(pedidosCliente.length === 0){
    document.getElementById("resultado").innerHTML =
        "<div class='card'>No se encontró información.</div>";
    return;
}

const cliente = pedidosCliente[0];

// ===== AGRUPAR POR TIPO =====
const grupos = {};
pedidosCliente.forEach(item=>{
    const tipo = item["TIPO"] || "SIN TIPO";
    if(!grupos[tipo]){
        grupos[tipo] = [];
    }
    grupos[tipo].push(item);
});

// ===== CONSTRUIR HTML =====
let html = "";

/* ===== DETALLE CLIENTE ===== */
html += `
<div class="card">
<b>NOMBRE.CLIENTE:</b> ${cliente["NOMBRE.CLIENTE"] || "-"}<br>
<b>CODIGO.CLIENTE:</b> ${cliente["CODIGO.CLIENTE"] || "-"}<br>
<b>formaPago:</b> ${cliente["formaPago"] || "-"}<br>
<b>departamento:</b> ${cliente["departamento"] || "-"} 
<b>distrito:</b> ${cliente["distrito"] || "-"}<br>
<b>Fecha.Facturacion:</b> ${cliente["Fecha.Facturacion"] || "-"}<br>
<b>VEHICULO:</b> ${cliente["VEHICULO"] || "-"}<br>
<b>LIQUIDADOR:</b> ${cliente["LIQUIDADOR"] || "-"}<br>
<b>NROS DE CONTACTO:</b> ${cliente["NROS DE CONTACTO"] || "-"}
</div>
`;

/* ===== DETALLE PEDIDO AGRUPADO ===== */
for(const tipo in grupos){

    html += `<div class="card"><b>${tipo}</b><br><br>`;

    grupos[tipo].forEach(item=>{

        html += `
        <div style="margin-bottom:10px;">
        <b>SKU:</b> ${item["SKU"] || "-"}<br>
        <b>Descripcion:</b> ${item["Descripcion"] || "-"}<br>
        <b>unidad:</b> ${item["unidad"] || "-"}<br>
        <b>Unidades Programadas:</b> ${item["Unidades Programadas"] || "-"}<br>
        <b>Kg Programados:</b> ${item["Kg Programados"] || "-"}<br>
        <b>Monto Programado:</b> ${item["Monto Programado"] || "-"}<br>
        <b>Monto:</b> ${item["Monto"] || "-"}
        </div>
        <hr>
        `;
    });

    html += `</div>`;
}

document.getElementById("resultado").innerHTML = html;


    }catch(error){
        console.error(error);
        alert("Error al consultar datos.");
    }
}

function enviarWhatsApp(){
    const codigo = document.getElementById("codigo").value.trim();
    let mensaje = "Hola, quiero consultar o subir un reclamo";
    if(codigo){
        mensaje += " sobre mi pedido código: " + codigo;
    }
    const url = "https://wa.me/51996639020?text=" + encodeURIComponent(mensaje);
    window.open(url, "_blank");
}
</script>

</head>

<body>

<div class="app">

    <div class="header">
        Consulta tu Pedido
    </div>

    <div class="container">

        <input type="text" id="codigo" placeholder="Ingrese su código de pedido">

        <button class="btn-primary" onclick="buscarPedido()">
            Consultar Pedido
        </button>

        <button class="btn-whatsapp" onclick="enviarWhatsApp()">
            Consulta o sube tu reclamo
        </button>

        <div id="resultado"></div>

        <div class="qr-section">
            <h4>Paga con Yape</h4>
            <img src="YAPEQRYUGOCORP.png" alt="QR Yape">
        </div>

    </div>

</div>

</body>
</html>
