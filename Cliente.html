<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Consulta tu Pedido</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
}

.container {
    background: white;
    padding: 30px;
    border-radius: 12px;
    width: 420px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

h2 {
    text-align: center;
}

input {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
}

button {
    width: 100%;
    padding: 12px;
    margin-top: 15px;
    border-radius: 8px;
    border: none;
    background: #1f4e9e;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

button:hover {
    background: #163c7a;
}

#resultado {
    margin-top: 20px;
    font-size: 14px;
}
</style>
</head>

<body>

<div class="container">
    <h2>Consulta tu Pedido</h2>

    <input type="text" id="codigoCliente" placeholder="Ingresa tu c贸digo">
    <button onclick="buscarCliente()">Buscar</button>

    <div id="resultado"></div>
</div>

<script>

let pedidos = [];

//  Cargar JSON al iniciar
fetch("pedidos.json")
.then(response => response.json())
.then(data => {
    pedidos = data;
})
.catch(error => {
    console.error("Error cargando pedidos.json:", error);
});

//  Detectar autom谩ticamente cualquier campo que contenga "monto"
function obtenerMonto(obj) {
    const claveMonto = Object.keys(obj).find(k =>
        k.toLowerCase().replace(/\s/g, "").includes("monto")
    );
    return claveMonto ? Number(obj[claveMonto]) : 0;
}

//  Buscar cliente
function buscarCliente() {

    const input = document.getElementById("codigoCliente");
    const resultadoDiv = document.getElementById("resultado");

    if (!input) {
        console.error("No existe input codigoCliente");
        return;
    }

    const codigo = input.value.trim();
    resultadoDiv.innerHTML = "";

    if (!codigo) {
        resultadoDiv.innerHTML = "<p>Ingrese un c贸digo.</p>";
        return;
    }

    const pedidosCliente = pedidos.filter(p =>
        String(p["CODIGO.CLIENTE"]).trim() === codigo
    );

    if (pedidosCliente.length === 0) {
        resultadoDiv.innerHTML = "<p>No se encontr贸 informaci贸n con ese c贸digo.</p>";
        return;
    }

    let subtotal = 0;

    let html = `
        <h3>${pedidosCliente[0]["NOMBRE.CLIENTE"]}</h3>
        <p><strong>Distrito:</strong> ${pedidosCliente[0]["distrito"]}</p>
        <p><strong>Provincia:</strong> ${pedidosCliente[0]["provincia"]}</p>
        <p><strong>Departamento:</strong> ${pedidosCliente[0]["departamento"]}</p>
        <hr>
        <table border="1" width="100%" cellspacing="0" cellpadding="4">
            <tr>
                <th>Producto</th>
                <th>Unidades</th>
                <th>Monto</th>
            </tr>
    `;

    pedidosCliente.forEach(p => {

        const monto = obtenerMonto(p);
        subtotal += monto;

        html += `
            <tr>
                <td>${p["Descripcion"]}</td>
                <td>${p["Unidades Programadas"]}</td>
                <td>S/ ${monto.toFixed(2)}</td>
            </tr>
        `;
    });

    const igv = subtotal * 0.18;
    const total = subtotal + igv;

    html += `
        </table>
        <hr>
        <p><strong>Subtotal:</strong> S/ ${subtotal.toFixed(2)}</p>
        <p><strong>IGV (18%):</strong> S/ ${igv.toFixed(2)}</p>
        <p><strong>Total:</strong> S/ ${total.toFixed(2)}</p>
        <hr>
        <p><strong>Conductor:</strong> ${pedidosCliente[0]["CONDUCTOR"]}</p>
        <p><strong>Veh铆culo:</strong> ${pedidosCliente[0]["VEHICULO"]}</p>
        <p><strong>Estado:</strong> ${pedidosCliente[0]["FechaPedido"]}</p>
    `;

    resultadoDiv.innerHTML = html;
}

</script>

</body>
</html>
