<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta tu Pedido</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    display: flex;
    justify-content: center;
    padding: 20px;
}

.app {
    width: 100%;
    max-width: 420px;
}

.card {
    background: white;
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

h2 {
    text-align: center;
    color: white;
}

input {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #ddd;
    font-size: 16px;
    margin-top: 15px;
}

button {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: bold;
    margin-top: 15px;
    cursor: pointer;
}

.btn-primary {
    background: #0b3d91;
    color: white;
}

.btn-primary:hover {
    background: #072d6b;
}

.estado {
    padding: 8px 12px;
    border-radius: 20px;
    display: inline-block;
    font-size: 13px;
    font-weight: bold;
    margin-top: 5px;
}

.estado.pendiente {
    background: #ffe0e0;
    color: #d60000;
}

.estado.entregado {
    background: #e0ffe7;
    color: #008f3d;
}

.producto {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 14px;
}

.total {
    font-size: 18px;
    font-weight: bold;
    margin-top: 10px;
    color: #0b3d91;
}

.whatsapp {
    background: #25D366;
    color: white;
    text-align: center;
}

.qr img {
    width: 180px;
    display: block;
    margin: 10px auto;
}
</style>
</head>

<body>

<div class="app">

<h2>Consulta tu Pedido</h2>

<div class="card">
    <input type="text" id="codigoCliente" placeholder="Ingresa tu código">
    <button class="btn-primary" onclick="buscarCliente()">Buscar Pedido</button>
</div>

<div id="resultado"></div>

</div>

<script>

let pedidos = [];

fetch("pedidos.json")
.then(response => response.json())
.then(data => pedidos = data)
.catch(error => console.error("Error cargando JSON:", error));

function obtenerMonto(obj) {
    const claveMonto = Object.keys(obj).find(k =>
        k.toLowerCase().replace(/\s/g, "").includes("monto")
    );
    return claveMonto ? Number(obj[claveMonto]) : 0;
}

function buscarCliente() {

    const codigo = document.getElementById("codigoCliente").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "";

    if (!codigo) {
        alert("Ingrese su código.");
        return;
    }

    const pedidosCliente = pedidos.filter(p =>
        String(p["CODIGO.CLIENTE"]).trim() === codigo
    );

    if (pedidosCliente.length === 0) {
        resultado.innerHTML = `<div class="card">No se encontró información.</div>`;
        return;
    }

    const p = pedidosCliente[0];
    let subtotal = 0;

    let productosHTML = "";

    pedidosCliente.forEach(item => {
        const monto = obtenerMonto(item);
        subtotal += monto;

        productosHTML += `
            <div class="producto">
                <div>${item["Descripcion"]}</div>
                <div>S/ ${monto.toFixed(2)}</div>
            </div>
        `;
    });

    const igv = subtotal * 0.18;
    const total = subtotal + igv;

    const estadoTexto = p["FechaPedido"] || "Pendiente";
    const estadoClase = estadoTexto.toLowerCase().includes("pendiente") 
        ? "pendiente" 
        : "entregado";

    const mensajeWA = encodeURIComponent(
        `Hola, soy el cliente código ${codigo} y tengo una consulta sobre mi pedido.`
    );

    resultado.innerHTML = `
        <div class="card">
            <h3>${p["NOMBRE.CLIENTE"]}</h3>
            <div class="estado ${estadoClase}">${estadoTexto}</div>
            <p><strong>Vehículo:</strong> ${p["VEHICULO"]}</p>
            <p><strong>Conductor:</strong> ${p["CONDUCTOR"]}</p>
        </div>

        <div class="card">
            ${productosHTML}
            <hr>
            <div>Subtotal: S/ ${subtotal.toFixed(2)}</div>
            <div>IGV (18%): S/ ${igv.toFixed(2)}</div>
            <div class="total">Total a pagar: S/ ${total.toFixed(2)}</div>
        </div>

        <div class="card qr">
            <strong>Paga con Yape</strong>
            <img src="YAPEQRYUGOCORP.png" alt="QR Yape">
        </div>

        <div class="card">
            <button class="whatsapp" 
                onclick="window.open('https://wa.me/51996639020?text=${mensajeWA}','_blank')">
                Consulta o Reclamo por WhatsApp
            </button>
        </div>
    `;
}

</script>

</body>
</html>
