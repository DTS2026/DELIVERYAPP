<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta tu Pedido</title>

<style>
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#F2F0F0);
    display: flex;
    justify-content: center;
    padding: 10px;
}

.app {
    width: 100%;
    max-width: 460px;
}

.card {
    background: white;
    border-radius: 18px;
    padding: 10px;
    margin-bottom: 15px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

h2 {
    text-align: center;
    color: white;
}

input {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #ddd;
    font-size: 16px;
    margin-top: 15px;
}

button {
    width: 100%;
    padding: 14px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: bold;
    margin-top: 15px;
    cursor: pointer;
}

.btn-primary {
    background: #0b3d91;
    color: white;
}

.btn-primary:hover {
    background: #072d6b;
}

.total {
    font-size: 18px;
    font-weight: bold;
    margin-top: 10px;
    color: #0b3d91;
}

.whatsapp {
    background: #25D366;
    color: white;
    text-align: center;
}

.qr img {
    width: 180px;
    display: block;
    margin: 10px auto;
}
</style>
</head>

<body>

<div class="app">

<h2>Consulta tu Pedido</h2>

<div class="card">
    <input type="text" id="codigoCliente" placeholder="Ingresa tu c√≥digo de cliente">
    <button class="btn-primary" onclick="buscarCliente()">Buscar mi Pedido</button>
</div>

<div id="resultado"></div>

</div>

<script>

let pedidos = [];

// üîπ Cargar JSON y normalizar nombres de campos
fetch("pedidos.json")
  .then(response => response.json())
  .then(data => {
      pedidos = data.map(pedido => {
          const obj = {};
          for (let key in pedido) {
              obj[key.trim()] = pedido[key]; // quitar espacios de nombres
          }
          return obj;
      });
  })
  .catch(error => console.error("Error cargando JSON:", error));

function buscarCliente() {

    const codigo = document.getElementById("codigoCliente").value.trim();
    const resultado = document.getElementById("resultado");
    resultado.innerHTML = "";

    if (!codigo) {
        alert("Ingrese su c√≥digo.");
        return;
    }

    // üîπ Buscar pedidos del cliente
    const pedidosCliente = pedidos.filter(p =>
        String(p["CODIGO.CLIENTE"]).trim() === codigo
    );

    if (pedidosCliente.length === 0) {
        resultado.innerHTML = `<div class="card">No se encontr√≥ informaci√≥n.</div>`;
        return;
    }

    const cliente = pedidosCliente[0];

    // üîπ AGRUPAR POR tipo
    const grupos = {};
    pedidosCliente.forEach(item => {
        const tipo = item["tipo"] || "SIN TIPO";  // ‚Üê correcci√≥n aqu√≠
        if (!grupos[tipo]) grupos[tipo] = [];
        grupos[tipo].push(item);
    });

    let subtotal = 0;
    let detalleHTML = "";

    for (const tipo in grupos) {

        detalleHTML += `
        <div class="card">
            <h4 style="margin-bottom:10px; color:#0b3d91;">${tipo}</h4>
        `;

        grupos[tipo].forEach(item => {

            const monto = Number(item["Monto"]) || 0;
            const precio = Number(item["Precio"]) || 0;
            subtotal += monto;

            detalleHTML += `
                <div style="
                    border:1px solid #eee;
                    border-radius:12px;
                    padding:12px;
                    margin-bottom:10px;
                    background:#f9f9f9;
                    font-size:14px;
                ">
                    <div style="font-weight:bold; color:#0b3d91; margin-bottom:4px;">
                        ${item["Descripcion"] || "-"}
                    </div>

                    <div><strong>SKU:</strong> ${item["SKU"] || "-"}</div>
                    <div><strong>Unidad:</strong> ${item["unidad"] || "-"}</div>
                    <div><strong>Cantidad:</strong> ${item["Unidades Programadas"] || "-"}</div>
                    <div><strong>Precio:</strong> S/ ${precio.toFixed(2)}</div>

                    <div style="
                        margin-top:6px;
                        font-weight:bold;
                        color:#0b3d91;
                    ">
                        Monto: S/ ${monto.toFixed(2)}
                    </div>
                </div>
            `;
        });

        detalleHTML += `</div>`;
    }

    const igv = subtotal * 0.18;
    const total = subtotal + igv;

    const mensajeWA = encodeURIComponent(
        `Hola, soy el cliente c√≥digo ${codigo} y tengo una consulta sobre mi pedido.`
    );

    // üîπ Mostrar informaci√≥n del cliente y detalle
    resultado.innerHTML = `


    
<div class="card" style="padding:14px; line-height:1.4; background: #f5f8fb;">
    <h3 style="margin-bottom:10px; color:#0b3d91; font-size:18px;">
        ${cliente["NOMBRE.CLIENTE"] || "-"}
    </h3>

    <div style="display:flex; flex-wrap:wrap; gap:10px; font-size:14px; color:#333;">
        <!-- C√≥digo y forma de pago -->
        <div style="flex: 1 1 45%; background:#e6f0ff; padding:6px 8px; border-radius:8px;">
            <strong>üÜî C√≥digo:</strong> ${cliente["CODIGO.CLIENTE"] || "-"}
        </div>

        <!-- Ubicaci√≥n -->
        <div style="flex: 1 1 45%; background:#e0f7e6; padding:6px 8px; border-radius:8px;">
            <strong>üìç Depto:</strong> ${cliente["departamento"] || "-"}
        </div>
        <div style="flex: 1 1 45%; background:#e0f7e6; padding:6px 8px; border-radius:8px;">
            <strong>üèò Distrito:</strong> ${cliente["distrito"] || "-"}
        </div>

        <!-- Facturaci√≥n y veh√≠culo -->

        <div style="flex: 1 1 45%; background:#fff3e6; padding:6px 8px; border-radius:8px;">
            <strong>üöö Veh√≠culo:</strong> ${cliente["VEHICULO"] || "-"}
        </div>

        <!-- Liquidador y contactos -->
        <div style="flex: 1 1 45%; background:#f9e6ff; padding:6px 8px; border-radius:8px;">
            <strong>üßæ Repartidor:</strong> ${cliente["LIQUIDADOR"] || "-"}
        </div>
        <div style="flex: 1 1 45%; background:#f9e6ff; padding:6px 8px; border-radius:8px;">
            <strong>üìû Contacto:</strong> ${cliente["NROS DE CONTACTO"] || "-"}
        </div>
    </div>
</div

        ${detalleHTML}

        <div class="card">
            <div>Subtotal: S/ ${subtotal.toFixed(2)}</div>
            <div>IGV (18%): S/ ${igv.toFixed(2)}</div>
            <div class="total">Total a pagar: S/ ${total.toFixed(2)}</div>
        </div>

        <div class="card qr">
            <strong>Paga con Yape</strong>
            <img src="YAPEQRYUGOCORP.png" alt="QR Yape">
        </div>

        <div class="card">
            <button class="whatsapp" 
                onclick="window.open('https://wa.me/51996639020?text=${mensajeWA}','_blank')">
                Consulta o Reclamo por WhatsApp
            </button>
        </div>
    `;
}

</script>

</body>
</html>



