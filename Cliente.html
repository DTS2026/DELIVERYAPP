<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Consulta tu Pedido</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f4f6f9;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:100vh;
}

.container{
    background:white;
    width:95%;
    max-width:450px;
    padding:25px;
    border-radius:15px;
    box-shadow:0 8px 25px rgba(0,0,0,0.1);
    text-align:center;
}

h2{
    margin-bottom:20px;
}

input{
    width:100%;
    padding:12px;
    border-radius:10px;
    border:1px solid #ccc;
    font-size:16px;
    margin-bottom:15px;
}

button{
    width:100%;
    padding:12px;
    border:none;
    border-radius:10px;
    background:#0b3d91;
    color:white;
    font-size:16px;
    cursor:pointer;
}

button:hover{
    background:#072d6b;
}

.resultado{
    margin-top:20px;
    text-align:left;
    display:none;
    border-top:1px solid #eee;
    padding-top:15px;
}

.producto{
    display:flex;
    justify-content:space-between;
    margin-bottom:6px;
}

.total{
    margin-top:10px;
    font-weight:bold;
}

.whatsapp{
    margin-top:15px;
    display:block;
    background:#25D366;
    text-align:center;
    padding:12px;
    border-radius:10px;
    color:white;
    text-decoration:none;
    font-weight:bold;
}

.qr{
    margin-top:20px;
    text-align:center;
}

.qr img{
    width:200px;
}
</style>
</head>

<body>

<div class="container">
    <h2>Consulta tu Pedido</h2>

    <input type="text" id="codigoCliente" placeholder="Ingresa tu código de cliente">

    <button onclick="buscarPedido()">Buscar</button>

    <div class="resultado" id="resultado"></div>
</div>

<script>

let pedidos = [];

fetch('pedidos.json')
.then(r => r.json())
.then(data => pedidos = data);

function obtenerMonto(obj){
    const key = Object.keys(obj).find(k => k.trim() === "Monto");
    if(!key) return 0;
    const valor = parseFloat(obj[key]);
    return isNaN(valor) ? 0 : valor;
}

function buscarPedido(){

    const codigoIngresado = document.getElementById("codigoCliente").value.trim();
    const resultadoDiv = document.getElementById("resultado");

    resultadoDiv.style.display = "none";
    resultadoDiv.innerHTML = "";

    if(!codigoIngresado) return;

    const pedidosCliente = pedidos.filter(p => 
        p["CODIGO.CLIENTE"].toString() === codigoIngresado
    );

    if(pedidosCliente.length === 0){
        alert("No se encontró información con ese código.");
        return;
    }

    const p = pedidosCliente[0];

    const subtotal = pedidosCliente.reduce((s,x)=> s + obtenerMonto(x),0);
    const igv = subtotal * 0.18;
    const totalGeneral = subtotal + igv;

    const detalleHTML = pedidosCliente.map(x => `
        <div class="producto">
            <div>${x.Descripcion}</div>
            <div>S/ ${obtenerMonto(x).toFixed(2)}</div>
        </div>
    `).join('');

    const mensaje = encodeURIComponent(
        `Hola, soy el cliente código ${codigoIngresado} y tengo una consulta sobre mi pedido.`
    );

    resultadoDiv.innerHTML = `
        <p><strong>Cliente:</strong> ${p["NOMBRE.CLIENTE"]}</p>
        <p><strong>Vehículo:</strong> ${p["VEHICULO"]}</p>
        <p><strong>Conductor:</strong> ${p["CONDUCTOR"]}</p>
        <p><strong>Repartidor:</strong> ${p["LIQUIDADOR"]}</p>

        <hr>

        ${detalleHTML}

        <div class="total">Subtotal: S/ ${subtotal.toFixed(2)}</div>
        <div class="total">IGV (18%): S/ ${igv.toFixed(2)}</div>
        <div class="total">TOTAL A PAGAR: S/ ${totalGeneral.toFixed(2)}</div>

        <div class="qr">
            <p><strong>Paga con Yape</strong></p>
            <img src="YAPEQRYUGOCORP.png" alt="QR Yape">
        </div>

        <a class="whatsapp"
           href="https://wa.me/51996639020?text=${mensaje}"
           target="_blank">
           Contactar Central por WhatsApp
        </a>
    `;

    resultadoDiv.style.display = "block";
}

</script>

</body>
</html>
